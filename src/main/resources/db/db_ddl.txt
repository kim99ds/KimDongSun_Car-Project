
/* ---------- BRAND ---------- */
CREATE TABLE "CAR_PROJECT"."BRAND"
(
  "BRAND_ID"    NUMBER NOT NULL ENABLE,
  "BRAND_NAME"  VARCHAR2(50) NOT NULL ENABLE,
  "COUNTRY_CODE" VARCHAR2(3),
  CONSTRAINT "PK_BRAND" PRIMARY KEY ("BRAND_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- CAR_COLOR ---------- */
CREATE TABLE "CAR_PROJECT"."CAR_COLOR"
(
  "COLOR_ID"    NUMBER NOT NULL ENABLE,
  "COLOR_NAME"  VARCHAR2(100) NOT NULL ENABLE,
  "COLOR_CODE"  VARCHAR2(20),
  "COLOR_PRICE" NUMBER DEFAULT 0 NOT NULL ENABLE,
  "COLOR_TYPE"  VARCHAR2(30),
  CONSTRAINT "CK_CAR_COLOR_PRICE" CHECK (COLOR_PRICE >= 0) ENABLE,
  CONSTRAINT "PK_CAR_COLOR" PRIMARY KEY ("COLOR_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- MEMBER ---------- */
CREATE TABLE "CAR_PROJECT"."MEMBER"
(
  "MEMBER_ID"  NUMBER NOT NULL ENABLE,
  "LOGIN_ID"   VARCHAR2(100) NOT NULL ENABLE,
  "PASSWORD"   VARCHAR2(200) NOT NULL ENABLE,
  "NAME"       VARCHAR2(100) NOT NULL ENABLE,
  "EMAIL"      VARCHAR2(200) NOT NULL ENABLE,
  "BIRTH_DATE" DATE NOT NULL ENABLE,
  "STATUS"     VARCHAR2(20) DEFAULT 'ACTIVE' NOT NULL ENABLE,
  "CREATED_AT" DATE DEFAULT SYSDATE NOT NULL ENABLE,
  "UPDATED_AT" DATE,
  CONSTRAINT "CK_MEMBER_STATUS" CHECK (STATUS IN ('ACTIVE','BLOCKED','DELETED')) ENABLE,
  CONSTRAINT "PK_MEMBER" PRIMARY KEY ("MEMBER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_MEMBER_LOGIN_ID" UNIQUE ("LOGIN_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_MEMBER_EMAIL" UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- ROLE ---------- */
CREATE TABLE "CAR_PROJECT"."ROLE"
(
  "ROLE_ID"   NUMBER NOT NULL ENABLE,
  "ROLE_NAME" VARCHAR2(50) NOT NULL ENABLE,
  CONSTRAINT "PK_ROLE" PRIMARY KEY ("ROLE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_ROLE_NAME" UNIQUE ("ROLE_NAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- CAR_MODEL (depends BRAND) ---------- */
CREATE TABLE "CAR_PROJECT"."CAR_MODEL"
(
  "MODEL_ID"     NUMBER NOT NULL ENABLE,
  "BRAND_ID"     NUMBER NOT NULL ENABLE,
  "MODEL_NAME"   VARCHAR2(100) NOT NULL ENABLE,
  "MODEL_YEAR"   NUMBER,
  "SEGMENT"      VARCHAR2(50),
  "RELEASE_DATE" DATE,
  "VIEW_COUNT"   NUMBER DEFAULT 0 NOT NULL ENABLE,
  "LIKE_COUNT"   NUMBER DEFAULT 0 NOT NULL ENABLE,
  CONSTRAINT "CK_CAR_MODEL_VIEW_COUNT" CHECK (VIEW_COUNT >= 0) ENABLE,
  CONSTRAINT "CK_CAR_MODEL_LIKE_COUNT" CHECK (LIKE_COUNT >= 0) ENABLE,
  CONSTRAINT "PK_CAR_MODEL" PRIMARY KEY ("MODEL_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- CAR_VARIANT (depends CAR_MODEL) ---------- */
CREATE TABLE "CAR_PROJECT"."CAR_VARIANT"
(
  "VARIANT_ID"      NUMBER NOT NULL ENABLE,
  "MODEL_ID"        NUMBER NOT NULL ENABLE,
  "ENGINE_TYPE"     VARCHAR2(100),
  "ENGINE_NAME"     VARCHAR2(100),
  "DISPLACEMENT_CC" NUMBER,
  "TRANSMISSION"    VARCHAR2(50),
  "DRIVE_TYPE"      VARCHAR2(100),
  "FUEL_EFFICIENCY" VARCHAR2(20),
  "CO2_EMISSION"    NUMBER,
  CONSTRAINT "PK_CAR_VARIANT" PRIMARY KEY ("VARIANT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- CAR_TRIM (depends CAR_VARIANT) ---------- */
CREATE TABLE "CAR_PROJECT"."CAR_TRIM"
(
  "TRIM_ID"     NUMBER NOT NULL ENABLE,
  "VARIANT_ID"  NUMBER NOT NULL ENABLE,
  "TRIM_NAME"   VARCHAR2(100) NOT NULL ENABLE,
  "BASE_PRICE"  NUMBER NOT NULL ENABLE,
  "DESCRIPTION" VARCHAR2(4000),
  CONSTRAINT "PK_CAR_TRIM" PRIMARY KEY ("TRIM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- CAR_IMAGE (depends CAR_MODEL) ---------- */
CREATE TABLE "CAR_PROJECT"."CAR_IMAGE"
(
  "IMAGE_ID"  NUMBER NOT NULL ENABLE,
  "MODEL_ID"  NUMBER NOT NULL ENABLE,
  "IMAGE_URL" VARCHAR2(500) NOT NULL ENABLE,
  "VIEW_TYPE" VARCHAR2(30) NOT NULL ENABLE,
  CONSTRAINT "PK_CAR_IMAGE" PRIMARY KEY ("IMAGE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;
ALTER TABLE "CAR_PROJECT"."CAR_IMAGE"
  ADD CONSTRAINT "CK_CAR_IMAGE_VIEW_TYPE"
  CHECK ("VIEW_TYPE" IN ('con','exterior')) ENABLE;
;

/* ---------- TRIM_COLOR (depends CAR_TRIM, CAR_COLOR) ---------- */
CREATE TABLE "CAR_PROJECT"."TRIM_COLOR"
(
  "TRIM_COLOR_ID" NUMBER NOT NULL ENABLE,
  "TRIM_ID"       NUMBER NOT NULL ENABLE,
  "COLOR_ID"      NUMBER NOT NULL ENABLE,
  CONSTRAINT "PK_TRIM_COLOR" PRIMARY KEY ("TRIM_COLOR_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_TRIM_COLOR" UNIQUE ("TRIM_ID", "COLOR_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_TRIMCOLOR_TRIMID_TCUID" UNIQUE ("TRIM_ID", "TRIM_COLOR_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- OPTION_ITEM (depends BRAND) ---------- */
CREATE TABLE "CAR_PROJECT"."OPTION_ITEM"
(
  "OPTION_ITEM_ID"  NUMBER NOT NULL ENABLE,
  "BRAND_ID"        NUMBER,
  "OPTION_NAME"     VARCHAR2(1000) NOT NULL ENABLE,
  "OPTION_DESC"     VARCHAR2(4000),
  "OPTION_PRICE"    NUMBER DEFAULT 0 NOT NULL ENABLE,
  "OPTION_TYPE"     VARCHAR2(30) NOT NULL ENABLE,
  "OPTION_CATEGORY" VARCHAR2(30) DEFAULT 'etc' NOT NULL ENABLE,
  "SELECT_RULE"     VARCHAR2(10) DEFAULT 'MULTI' NOT NULL ENABLE,
  CONSTRAINT "CK_OPTION_TYPE" CHECK (OPTION_TYPE IN ('PACKAGE','SINGLE')) ENABLE,
  CONSTRAINT "CK_OPTION_ITEM_PRICE" CHECK (OPTION_PRICE >= 0) ENABLE,
  CONSTRAINT "CK_OPTION_RULE" CHECK (SELECT_RULE IN ('SINGLE','MULTI')) ENABLE,
  CONSTRAINT "PK_OPTION_ITEM" PRIMARY KEY ("OPTION_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "CK_OPTION_CATEGORY"
    CHECK (LOWER("OPTION_CATEGORY") IN ('wheel','assistant','interior','seats','etc')) ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- OPTION_GROUP (depends BRAND) ---------- */
CREATE TABLE "CAR_PROJECT"."OPTION_GROUP"
(
  "OPTION_GROUP_ID" NUMBER NOT NULL ENABLE,
  "BRAND_ID"        NUMBER,
  "GROUP_NAME"      VARCHAR2(200) NOT NULL ENABLE,
  "SELECT_RULE"     VARCHAR2(10) NOT NULL ENABLE,
  "DESCRIPTION"     VARCHAR2(1000),
  CONSTRAINT "CK_OPTION_GROUP_RULE" CHECK (SELECT_RULE IN ('SINGLE','MULTI')) ENABLE,
  CONSTRAINT "PK_OPTION_GROUP" PRIMARY KEY ("OPTION_GROUP_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- OPTION_GROUP_ITEM (depends OPTION_GROUP, OPTION_ITEM) ---------- */
CREATE TABLE "CAR_PROJECT"."OPTION_GROUP_ITEM"
(
  "OPTION_GROUP_ITEM_ID" NUMBER NOT NULL ENABLE,
  "OPTION_GROUP_ID"      NUMBER NOT NULL ENABLE,
  "OPTION_ITEM_ID"       NUMBER NOT NULL ENABLE,
  CONSTRAINT "PK_OPTION_GROUP_ITEM" PRIMARY KEY ("OPTION_GROUP_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_OGI_GROUP_OPTION" UNIQUE ("OPTION_GROUP_ID", "OPTION_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- OPTION_DEPENDENCY (depends OPTION_ITEM) ---------- */
CREATE TABLE "CAR_PROJECT"."OPTION_DEPENDENCY"
(
  "OPTION_DEPENDENCY_ID"    NUMBER NOT NULL ENABLE,
  "OPTION_ITEM_ID"          NUMBER NOT NULL ENABLE,
  "RELATED_OPTION_ITEM_ID"  NUMBER NOT NULL ENABLE,
  "RULE_TYPE"               VARCHAR2(10) NOT NULL ENABLE,
  CONSTRAINT "CK_OPTION_DEP_RULE" CHECK (RULE_TYPE IN ('REQUIRES','EXCLUDES')) ENABLE,
  CONSTRAINT "CK_OPTION_DEP_NOT_SELF" CHECK (OPTION_ITEM_ID <> RELATED_OPTION_ITEM_ID) ENABLE,
  CONSTRAINT "PK_OPTION_DEPENDENCY" PRIMARY KEY ("OPTION_DEPENDENCY_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_OPTION_DEP" UNIQUE ("OPTION_ITEM_ID", "RELATED_OPTION_ITEM_ID", "RULE_TYPE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- OPTION_PACKAGE_ITEM (depends OPTION_ITEM) ---------- */
CREATE TABLE "CAR_PROJECT"."OPTION_PACKAGE_ITEM"
(
  "OPTION_PACKAGE_ITEM_ID" NUMBER NOT NULL ENABLE,
  "PACKAGE_OPTION_ITEM_ID" NUMBER NOT NULL ENABLE,
  "CHILD_OPTION_ITEM_ID"   NUMBER NOT NULL ENABLE,
  "IS_INCLUDED"            CHAR(1) DEFAULT 'Y' NOT NULL ENABLE,
  "SORT_ORDER"             NUMBER,
  CONSTRAINT "CK_OPI_INCLUDED" CHECK (IS_INCLUDED IN ('Y','N')) ENABLE,
  CONSTRAINT "PK_OPTION_PACKAGE_ITEM" PRIMARY KEY ("OPTION_PACKAGE_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_OPI_PACKAGE_CHILD" UNIQUE ("PACKAGE_OPTION_ITEM_ID", "CHILD_OPTION_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- TRIM_OPTION (depends CAR_TRIM, OPTION_ITEM) ---------- */
CREATE TABLE "CAR_PROJECT"."TRIM_OPTION"
(
  "TRIM_OPTION_ID" NUMBER NOT NULL ENABLE,
  "TRIM_ID"        NUMBER NOT NULL ENABLE,
  "OPTION_ITEM_ID" NUMBER NOT NULL ENABLE,
  "IS_REQUIRED"    CHAR(1) DEFAULT 'N' NOT NULL ENABLE,
  CONSTRAINT "CK_TRIM_OPTION_REQUIRED" CHECK (IS_REQUIRED IN ('Y','N')) ENABLE,
  CONSTRAINT "PK_TRIM_OPTION" PRIMARY KEY ("TRIM_OPTION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_TRIM_OPTION" UNIQUE ("TRIM_ID", "OPTION_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- QUOTE (depends MEMBER, CAR_TRIM, TRIM_COLOR) ---------- */
CREATE TABLE "CAR_PROJECT"."QUOTE"
(
  "QUOTE_ID"       NUMBER NOT NULL ENABLE,
  "MEMBER_ID"      NUMBER NOT NULL ENABLE,
  "TRIM_ID"        NUMBER NOT NULL ENABLE,
  "TRIM_COLOR_ID"  NUMBER,
  "BASE_PRICE"     NUMBER NOT NULL ENABLE,
  "OPTION_PRICE"   NUMBER DEFAULT 0 NOT NULL ENABLE,
  "DISCOUNT_PRICE" NUMBER DEFAULT 0 NOT NULL ENABLE,
  "TOTAL_PRICE"    NUMBER NOT NULL ENABLE,
  "STATUS"         VARCHAR2(20) DEFAULT 'CREATED' NOT NULL ENABLE,
  "CREATED_AT"     DATE DEFAULT SYSDATE NOT NULL ENABLE,
  "UPDATED_AT"     DATE,
  CONSTRAINT "CK_QUOTE_PRICE" CHECK
  (
    BASE_PRICE >= 0 AND OPTION_PRICE >= 0 AND DISCOUNT_PRICE >= 0 AND TOTAL_PRICE >= 0
  ) ENABLE,
  CONSTRAINT "PK_QUOTE" PRIMARY KEY ("QUOTE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- QUOTE_OPTION (depends QUOTE, OPTION_ITEM) ---------- */
CREATE TABLE "CAR_PROJECT"."QUOTE_OPTION"
(
  "QUOTE_OPTION_ID"       NUMBER NOT NULL ENABLE,
  "QUOTE_ID"              NUMBER NOT NULL ENABLE,
  "OPTION_ITEM_ID"        NUMBER NOT NULL ENABLE,
  "OPTION_PRICE"          NUMBER NOT NULL ENABLE,
  "PACKAGE_OPTION_ITEM_ID" NUMBER,
  CONSTRAINT "CK_QUOTE_OPTION_PRICE" CHECK (OPTION_PRICE >= 0) ENABLE,
  CONSTRAINT "CK_QO_PACKAGE_NOT_SELF"
    CHECK (PACKAGE_OPTION_ITEM_ID IS NULL OR PACKAGE_OPTION_ITEM_ID <> OPTION_ITEM_ID) ENABLE,
  CONSTRAINT "PK_QUOTE_OPTION" PRIMARY KEY ("QUOTE_OPTION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_QUOTE_OPTION" UNIQUE ("QUOTE_ID", "OPTION_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- MEMBER_ROLE (depends MEMBER, ROLE) ---------- */
CREATE TABLE "CAR_PROJECT"."MEMBER_ROLE"
(
  "MEMBER_ID" NUMBER NOT NULL ENABLE,
  "ROLE_ID"   NUMBER NOT NULL ENABLE,
  CONSTRAINT "PK_MEMBER_ROLE" PRIMARY KEY ("MEMBER_ID", "ROLE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- EVENT (depends MEMBER) ---------- */
CREATE TABLE "CAR_PROJECT"."EVENT"
(
  "EVENT_ID"     NUMBER NOT NULL ENABLE,
  "TITLE"        VARCHAR2(200) NOT NULL ENABLE,
  "DESCRIPTION"  VARCHAR2(4000),
  "START_DATE"   DATE NOT NULL ENABLE,
  "END_DATE"     DATE NOT NULL ENABLE,
  "STATUS"       VARCHAR2(20) DEFAULT 'READY' NOT NULL ENABLE,
  "BANNER_IMAGE" VARCHAR2(255),
  "CREATED_BY"   NUMBER NOT NULL ENABLE,
  "CREATED_AT"   DATE DEFAULT SYSDATE NOT NULL ENABLE,
  "UPDATED_AT"   DATE,
  CONSTRAINT "CK_EVENT_STATUS" CHECK (STATUS IN ('READY','ACTIVE','INACTIVE','END')) ENABLE,
  CONSTRAINT "CK_EVENT_DATES"  CHECK (END_DATE >= START_DATE) ENABLE,
  CONSTRAINT "PK_EVENT" PRIMARY KEY ("EVENT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- EVENT_POLICY (depends EVENT) ---------- */
CREATE TABLE "CAR_PROJECT"."EVENT_POLICY"
(
  "EVENT_POLICY_ID" NUMBER NOT NULL ENABLE,
  "EVENT_ID"        NUMBER NOT NULL ENABLE,
  "DISCOUNT_TYPE"   VARCHAR2(20) NOT NULL ENABLE,
  "DISCOUNT_VALUE"  NUMBER NOT NULL ENABLE,
  CONSTRAINT "CK_EVENT_POLICY_TYPE" CHECK (DISCOUNT_TYPE IN ('RATE','PRICE')) ENABLE,
  CONSTRAINT "CK_EVENT_POLICY_VALUE" CHECK
  (
    (DISCOUNT_TYPE = 'RATE'  AND DISCOUNT_VALUE BETWEEN 1 AND 100)
 OR (DISCOUNT_TYPE = 'PRICE' AND DISCOUNT_VALUE > 0)
  ) ENABLE,
  CONSTRAINT "PK_EVENT_POLICY" PRIMARY KEY ("EVENT_POLICY_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- EVENT_TARGET (depends EVENT) ---------- */
CREATE TABLE "CAR_PROJECT"."EVENT_TARGET"
(
  "EVENT_TARGET_ID" NUMBER NOT NULL ENABLE,
  "EVENT_ID"        NUMBER NOT NULL ENABLE,
  "TARGET_TYPE"     VARCHAR2(30) NOT NULL ENABLE,
  "TARGET_VALUE"    VARCHAR2(100),
  "CREATED_AT"      DATE DEFAULT SYSDATE NOT NULL ENABLE,
  CONSTRAINT "CK_EVENT_TARGET_TYPE"
    CHECK (TARGET_TYPE IN ('ALL','BRAND','CAR_TYPE','FUEL','SEAT')) ENABLE,
  CONSTRAINT "PK_EVENT_TARGET" PRIMARY KEY ("EVENT_TARGET_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_EVENT_TARGET" UNIQUE ("EVENT_ID", "TARGET_TYPE", "TARGET_VALUE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- LANDING_BANNER ---------- */
CREATE TABLE "CAR_PROJECT"."LANDING_BANNER"
(
  "BANNER_ID"  NUMBER NOT NULL ENABLE,
  "TITLE"      VARCHAR2(100),
  "SUB_TITLE"  VARCHAR2(200),
  "IMAGE_URL"  VARCHAR2(300),
  "LINK_URL"   VARCHAR2(300),
  "IS_VISIBLE" CHAR(1) DEFAULT 'Y',
  "SORT_ORDER" NUMBER DEFAULT 0,
  "CREATED_AT" DATE DEFAULT SYSDATE,
  CONSTRAINT "PK_LANDING_BANNER" PRIMARY KEY ("BANNER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

/* ---------- MODEL_LIKE (depends CAR_MODEL, MEMBER) ---------- */
CREATE TABLE "CAR_PROJECT"."MODEL_LIKE"
(
  "MODEL_ID"   NUMBER NOT NULL ENABLE,
  "MEMBER_ID"  NUMBER NOT NULL ENABLE,
  "CREATED_AT" DATE DEFAULT SYSDATE NOT NULL ENABLE,
  CONSTRAINT "PK_MODEL_LIKE" PRIMARY KEY ("MODEL_ID", "MEMBER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION DEFERRED
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
TABLESPACE "USERS";
;

/* ---------- QUOTE_EVENT (depends QUOTE, EVENT) ---------- */
CREATE TABLE "CAR_PROJECT"."QUOTE_EVENT"
(
  "QUOTE_EVENT_ID" NUMBER NOT NULL ENABLE,
  "QUOTE_ID"       NUMBER NOT NULL ENABLE,
  "EVENT_ID"       NUMBER NOT NULL ENABLE,
  "DISCOUNT_PRICE" NUMBER NOT NULL ENABLE,
  CONSTRAINT "CK_QUOTE_EVENT_PRICE" CHECK (DISCOUNT_PRICE >= 0) ENABLE,
  CONSTRAINT "PK_QUOTE_EVENT" PRIMARY KEY ("QUOTE_EVENT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE,
  CONSTRAINT "UK_QUOTE_EVENT" UNIQUE ("QUOTE_ID", "EVENT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ENABLE
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "USERS";
;

-- =========================================================
-- 2) SEQUENCES (tables after OK, before triggers recommended)
-- =========================================================

CREATE SEQUENCE CAR_PROJECT.SEQ_BRAND              INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_CAR_COLOR          INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_CAR_IMAGE          INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_CAR_MODEL          INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_CAR_TRIM           INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_CAR_VARIANT        INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_EVENT              INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_EVENT_POLICY       INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_EVENT_TARGET       INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_MEMBER             INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_OPTION_ITEM        INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_OPTION_GROUP       INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_OPTION_GROUP_ITEM  INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_OPTION_DEPENDENCY  INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_OPTION_PACKAGE_ITEM INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_LANDING_BANNER     INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_QUOTE              INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_QUOTE_EVENT        INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_QUOTE_OPTION       INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_ROLE               INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

CREATE SEQUENCE CAR_PROJECT.SEQ_TRIM_COLOR         INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;
CREATE SEQUENCE CAR_PROJECT.SEQ_TRIM_OPTION        INCREMENT BY 1 MINVALUE 1 MAXVALUE 9999999999999999999999999999 NOCYCLE CACHE 20 NOORDER;

-- =========================================================
-- 3) FOREIGN KEYS (BULK ADD AT THE END)
-- =========================================================

ALTER TABLE "CAR_PROJECT"."CAR_MODEL"
  ADD CONSTRAINT "FK_MODEL_BRAND"
  FOREIGN KEY ("BRAND_ID")
  REFERENCES "CAR_PROJECT"."BRAND" ("BRAND_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."CAR_VARIANT"
  ADD CONSTRAINT "FK_VARIANT_MODEL"
  FOREIGN KEY ("MODEL_ID")
  REFERENCES "CAR_PROJECT"."CAR_MODEL" ("MODEL_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."CAR_TRIM"
  ADD CONSTRAINT "FK_TRIM_VARIANT"
  FOREIGN KEY ("VARIANT_ID")
  REFERENCES "CAR_PROJECT"."CAR_VARIANT" ("VARIANT_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."CAR_IMAGE"
  ADD CONSTRAINT "FK_IMAGE_MODEL"
  FOREIGN KEY ("MODEL_ID")
  REFERENCES "CAR_PROJECT"."CAR_MODEL" ("MODEL_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."TRIM_COLOR"
  ADD CONSTRAINT "FK_TRIM_COLOR_TRIM"
  FOREIGN KEY ("TRIM_ID")
  REFERENCES "CAR_PROJECT"."CAR_TRIM" ("TRIM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."TRIM_COLOR"
  ADD CONSTRAINT "FK_TRIM_COLOR_COLOR"
  FOREIGN KEY ("COLOR_ID")
  REFERENCES "CAR_PROJECT"."CAR_COLOR" ("COLOR_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."OPTION_ITEM"
  ADD CONSTRAINT "FK_OPTION_BRAND"
  FOREIGN KEY ("BRAND_ID")
  REFERENCES "CAR_PROJECT"."BRAND" ("BRAND_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."OPTION_GROUP"
  ADD CONSTRAINT "FK_OPTION_GROUP_BRAND"
  FOREIGN KEY ("BRAND_ID")
  REFERENCES "CAR_PROJECT"."BRAND" ("BRAND_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."OPTION_GROUP_ITEM"
  ADD CONSTRAINT "FK_OGI_GROUP"
  FOREIGN KEY ("OPTION_GROUP_ID")
  REFERENCES "CAR_PROJECT"."OPTION_GROUP" ("OPTION_GROUP_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."OPTION_GROUP_ITEM"
  ADD CONSTRAINT "FK_OGI_OPTION"
  FOREIGN KEY ("OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."OPTION_DEPENDENCY"
  ADD CONSTRAINT "FK_DEP_OPT"
  FOREIGN KEY ("OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."OPTION_DEPENDENCY"
  ADD CONSTRAINT "FK_DEP_RELATED"
  FOREIGN KEY ("RELATED_OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."OPTION_PACKAGE_ITEM"
  ADD CONSTRAINT "FK_OPI_PACKAGE"
  FOREIGN KEY ("PACKAGE_OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."OPTION_PACKAGE_ITEM"
  ADD CONSTRAINT "FK_OPI_CHILD"
  FOREIGN KEY ("CHILD_OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."TRIM_OPTION"
  ADD CONSTRAINT "FK_TRIM_OPTION_TRIM"
  FOREIGN KEY ("TRIM_ID")
  REFERENCES "CAR_PROJECT"."CAR_TRIM" ("TRIM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."TRIM_OPTION"
  ADD CONSTRAINT "FK_TRIM_OPTION_ITEM"
  FOREIGN KEY ("OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."QUOTE"
  ADD CONSTRAINT "FK_QUOTE_MEMBER"
  FOREIGN KEY ("MEMBER_ID")
  REFERENCES "CAR_PROJECT"."MEMBER" ("MEMBER_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."QUOTE"
  ADD CONSTRAINT "FK_QUOTE_TRIM"
  FOREIGN KEY ("TRIM_ID")
  REFERENCES "CAR_PROJECT"."CAR_TRIM" ("TRIM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."QUOTE"
  ADD CONSTRAINT "FK_QUOTE_TRIMCOLOR"
  FOREIGN KEY ("TRIM_ID", "TRIM_COLOR_ID")
  REFERENCES "CAR_PROJECT"."TRIM_COLOR" ("TRIM_ID", "TRIM_COLOR_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."QUOTE_OPTION"
  ADD CONSTRAINT "FK_QO_QUOTE"
  FOREIGN KEY ("QUOTE_ID")
  REFERENCES "CAR_PROJECT"."QUOTE" ("QUOTE_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."QUOTE_OPTION"
  ADD CONSTRAINT "FK_QO_OPTION"
  FOREIGN KEY ("OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."QUOTE_OPTION"
  ADD CONSTRAINT "FK_QO_PACKAGE_OPTION"
  FOREIGN KEY ("PACKAGE_OPTION_ITEM_ID")
  REFERENCES "CAR_PROJECT"."OPTION_ITEM" ("OPTION_ITEM_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."MEMBER_ROLE"
  ADD CONSTRAINT "FK_MEMBER_ROLE_MEMBER"
  FOREIGN KEY ("MEMBER_ID")
  REFERENCES "CAR_PROJECT"."MEMBER" ("MEMBER_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."MEMBER_ROLE"
  ADD CONSTRAINT "FK_MEMBER_ROLE_ROLE"
  FOREIGN KEY ("ROLE_ID")
  REFERENCES "CAR_PROJECT"."ROLE" ("ROLE_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."EVENT"
  ADD CONSTRAINT "FK_EVENT_CREATED_BY"
  FOREIGN KEY ("CREATED_BY")
  REFERENCES "CAR_PROJECT"."MEMBER" ("MEMBER_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."EVENT_POLICY"
  ADD CONSTRAINT "FK_EVENT_POLICY_EVENT"
  FOREIGN KEY ("EVENT_ID")
  REFERENCES "CAR_PROJECT"."EVENT" ("EVENT_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."EVENT_TARGET"
  ADD CONSTRAINT "FK_EVENT_TARGET_EVENT"
  FOREIGN KEY ("EVENT_ID")
  REFERENCES "CAR_PROJECT"."EVENT" ("EVENT_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."MODEL_LIKE"
  ADD CONSTRAINT "FK_MODEL_LIKE_MODEL"
  FOREIGN KEY ("MODEL_ID")
  REFERENCES "CAR_PROJECT"."CAR_MODEL" ("MODEL_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."MODEL_LIKE"
  ADD CONSTRAINT "FK_MODEL_LIKE_MEMBER"
  FOREIGN KEY ("MEMBER_ID")
  REFERENCES "CAR_PROJECT"."MEMBER" ("MEMBER_ID") ENABLE;
;

ALTER TABLE "CAR_PROJECT"."QUOTE_EVENT"
  ADD CONSTRAINT "FK_QE_QUOTE"
  FOREIGN KEY ("QUOTE_ID")
  REFERENCES "CAR_PROJECT"."QUOTE" ("QUOTE_ID") ENABLE;
;
ALTER TABLE "CAR_PROJECT"."QUOTE_EVENT"
  ADD CONSTRAINT "FK_QE_EVENT"
  FOREIGN KEY ("EVENT_ID")
  REFERENCES "CAR_PROJECT"."EVENT" ("EVENT_ID") ENABLE;
;

-- =========================================================
-- 4) INDEXES
-- =========================================================

CREATE INDEX "CAR_PROJECT"."IDX_EVENT_STATUS" ON "CAR_PROJECT"."EVENT" ("STATUS")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE UNIQUE INDEX "CAR_PROJECT"."UIX_OPTION_NAME_BRAND" ON "CAR_PROJECT"."OPTION_ITEM"
  (NVL("BRAND_ID",0), "OPTION_NAME")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_OGI_OPTION" ON "CAR_PROJECT"."OPTION_GROUP_ITEM" ("OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_OGI_GROUP" ON "CAR_PROJECT"."OPTION_GROUP_ITEM" ("OPTION_GROUP_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_DEP_OPT" ON "CAR_PROJECT"."OPTION_DEPENDENCY" ("OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_DEP_RELATED" ON "CAR_PROJECT"."OPTION_DEPENDENCY" ("RELATED_OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_OPI_PACKAGE" ON "CAR_PROJECT"."OPTION_PACKAGE_ITEM" ("PACKAGE_OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_OPI_CHILD" ON "CAR_PROJECT"."OPTION_PACKAGE_ITEM" ("CHILD_OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_QO_QUOTE_PACKAGE" ON "CAR_PROJECT"."QUOTE_OPTION" ("QUOTE_ID", "PACKAGE_OPTION_ITEM_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS";
;

CREATE INDEX "CAR_PROJECT"."IDX_MODEL_LIKE_MEMBER" ON "CAR_PROJECT"."MODEL_LIKE" ("MEMBER_ID")
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  TABLESPACE "USERS";
;

-- =========================================================
-- 5) TRIGGERS (FIXED)
-- =========================================================

/* --- OPTION_PACKAGE_ITEM: type guard --- */
CREATE OR REPLACE NONEDITIONABLE TRIGGER "CAR_PROJECT"."TRG_OPI_TYPE_GUARD"
BEFORE INSERT OR UPDATE ON "CAR_PROJECT"."OPTION_PACKAGE_ITEM"
FOR EACH ROW
DECLARE
  v_pkg_type   "CAR_PROJECT"."OPTION_ITEM"."OPTION_TYPE"%TYPE;
  v_child_type "CAR_PROJECT"."OPTION_ITEM"."OPTION_TYPE"%TYPE;
BEGIN
  SELECT OPTION_TYPE INTO v_pkg_type
    FROM "CAR_PROJECT"."OPTION_ITEM"
   WHERE OPTION_ITEM_ID = :NEW.PACKAGE_OPTION_ITEM_ID;

  IF v_pkg_type <> 'PACKAGE' THEN
    RAISE_APPLICATION_ERROR(-20011, 'PACKAGE_OPTION_ITEM_ID must be OPTION_TYPE=PACKAGE');
  END IF;

  SELECT OPTION_TYPE INTO v_child_type
    FROM "CAR_PROJECT"."OPTION_ITEM"
   WHERE OPTION_ITEM_ID = :NEW.CHILD_OPTION_ITEM_ID;

  IF v_child_type <> 'SINGLE' THEN
    RAISE_APPLICATION_ERROR(-20012, 'CHILD_OPTION_ITEM_ID must be OPTION_TYPE=SINGLE');
  END IF;

  IF :NEW.PACKAGE_OPTION_ITEM_ID = :NEW.CHILD_OPTION_ITEM_ID THEN
    RAISE_APPLICATION_ERROR(-20013, 'Package and child option cannot be the same');
  END IF;
END;
/
ALTER TRIGGER "CAR_PROJECT"."TRG_OPI_TYPE_GUARD" ENABLE;
;

/* --- QUOTE_OPTION: package mapping guard --- */
CREATE OR REPLACE NONEDITIONABLE TRIGGER "CAR_PROJECT"."TRG_QO_PACKAGE_GUARD"
BEFORE INSERT OR UPDATE ON "CAR_PROJECT"."QUOTE_OPTION"
FOR EACH ROW
DECLARE
  v_opt_type  "CAR_PROJECT"."OPTION_ITEM"."OPTION_TYPE"%TYPE;
  v_pkg_type  "CAR_PROJECT"."OPTION_ITEM"."OPTION_TYPE"%TYPE;
  v_map_cnt   NUMBER;
BEGIN
  IF :NEW.PACKAGE_OPTION_ITEM_ID IS NULL THEN
    RETURN;
  END IF;

  SELECT OPTION_TYPE INTO v_opt_type
    FROM "CAR_PROJECT"."OPTION_ITEM"
   WHERE OPTION_ITEM_ID = :NEW.OPTION_ITEM_ID;

  IF v_opt_type <> 'SINGLE' THEN
    RAISE_APPLICATION_ERROR(-20021, 'PACKAGE_OPTION_ITEM_ID is set -> OPTION_ITEM_ID must be SINGLE');
  END IF;

  SELECT OPTION_TYPE INTO v_pkg_type
    FROM "CAR_PROJECT"."OPTION_ITEM"
   WHERE OPTION_ITEM_ID = :NEW.PACKAGE_OPTION_ITEM_ID;

  IF v_pkg_type <> 'PACKAGE' THEN
    RAISE_APPLICATION_ERROR(-20022, 'PACKAGE_OPTION_ITEM_ID must be OPTION_TYPE=PACKAGE');
  END IF;

  SELECT COUNT(*) INTO v_map_cnt
    FROM "CAR_PROJECT"."OPTION_PACKAGE_ITEM" opi
   WHERE opi.PACKAGE_OPTION_ITEM_ID = :NEW.PACKAGE_OPTION_ITEM_ID
     AND opi.CHILD_OPTION_ITEM_ID   = :NEW.OPTION_ITEM_ID
     AND opi.IS_INCLUDED = 'Y';

  IF v_map_cnt = 0 THEN
    RAISE_APPLICATION_ERROR(-20023, 'This child option is not included in the package.');
  END IF;
END;
/
ALTER TRIGGER "CAR_PROJECT"."TRG_QO_PACKAGE_GUARD" ENABLE;
;

/* --- QUOTE_OPTION: validate placeholder (원본 유지) --- */
CREATE OR REPLACE NONEDITIONABLE TRIGGER "CAR_PROJECT"."TRG_QO_VALIDATE"
FOR INSERT OR UPDATE OR DELETE ON "CAR_PROJECT"."QUOTE_OPTION"
COMPOUND TRIGGER

  TYPE t_quote_ids IS TABLE OF NUMBER INDEX BY PLS_INTEGER;
  g_quote_ids t_quote_ids;
  g_cnt PLS_INTEGER := 0;

  PROCEDURE add_quote_id(p_quote_id NUMBER) IS
  BEGIN
    IF p_quote_id IS NULL THEN
      RETURN;
    END IF;

    g_cnt := g_cnt + 1;
    g_quote_ids(g_cnt) := p_quote_id;
  END add_quote_id;

  BEFORE STATEMENT IS
  BEGIN
    g_quote_ids.DELETE;
    g_cnt := 0;
  END BEFORE STATEMENT;

  AFTER EACH ROW IS
  BEGIN
    IF INSERTING OR UPDATING THEN
      add_quote_id(:NEW.quote_id);
    ELSIF DELETING THEN
      add_quote_id(:OLD.quote_id);
    END IF;
  END AFTER EACH ROW;

  AFTER STATEMENT IS
  BEGIN
    NULL;
  END AFTER STATEMENT;

END TRG_QO_VALIDATE;
/
ALTER TRIGGER "CAR_PROJECT"."TRG_QO_VALIDATE" ENABLE;
;

/* =========================================================
 * MODEL_LIKE TRIGGERS (FIXED)
 * - INC: create (없던 트리거 ENABLE 제거)
 * - DEC: 0 방어 버전 1개만 유지
 * ========================================================= */

CREATE OR REPLACE NONEDITIONABLE TRIGGER "CAR_PROJECT"."TRG_MODEL_LIKE_INC"
AFTER INSERT ON "CAR_PROJECT"."MODEL_LIKE"
FOR EACH ROW
BEGIN
  UPDATE "CAR_PROJECT"."CAR_MODEL"
     SET LIKE_COUNT = LIKE_COUNT + 1
   WHERE MODEL_ID = :NEW.MODEL_ID;
END;
/
ALTER TRIGGER "CAR_PROJECT"."TRG_MODEL_LIKE_INC" ENABLE;
;

CREATE OR REPLACE NONEDITIONABLE TRIGGER "CAR_PROJECT"."TRG_MODEL_LIKE_DEC"
AFTER DELETE ON "CAR_PROJECT"."MODEL_LIKE"
FOR EACH ROW
BEGIN
  UPDATE "CAR_PROJECT"."CAR_MODEL"
     SET LIKE_COUNT = CASE
                        WHEN LIKE_COUNT > 0 THEN LIKE_COUNT - 1
                        ELSE 0
                      END
   WHERE MODEL_ID = :OLD.MODEL_ID;
END;
/
ALTER TRIGGER "CAR_PROJECT"."TRG_MODEL_LIKE_DEC" ENABLE;
;

commit;

-- =========================================================
-- DONE
-- =========================================================
